---
layout: post
title: Konfigurasi ITNSA OpenVPN auth LDAP
date: '2019-02-10T08:26:00.002+07:00'
author: Nasohi Ciptandani
tags:
- OpenVPN
- ITNSA
modified_time: '2019-05-25T00:03:19.641+07:00'
thumbnail: https://2.bp.blogspot.com/-a4e0V3EJpgg/XF92wRFb2HI/AAAAAAAABUY/QEDQsiD-lW02wRte51a3u-QcWbkI7UXnwCLcBGAs/s72-c/2019-02-10%2B07_52_50-Window.png
blogger_id: tag:blogger.com,1999:blog-7821506235811301823.post-6782048386277859798
blogger_orig_url: https://nciptandani.blogspot.com/2019/02/konfigurasi-itnsa-openvpn-auth-ldap.html
---

Sebelum mencoba OpenVPN auth OpenLDAP, pastikan terlebih dahulu hal-hal berikut:<br /><br />1. Konfigurasi OpenVPN terlebih dahulu agar koneksi sudah berfungsi dengan baik.<br /><br />2. OpenLDAP sudah terinstall dan terkonfigurasi, pastikan user yang akan digunakan sudah bisa di query.<br /><br />ldapsearch<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://2.bp.blogspot.com/-a4e0V3EJpgg/XF92wRFb2HI/AAAAAAAABUY/QEDQsiD-lW02wRte51a3u-QcWbkI7UXnwCLcBGAs/s1600/2019-02-10%2B07_52_50-Window.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="520" data-original-width="806" src="https://2.bp.blogspot.com/-a4e0V3EJpgg/XF92wRFb2HI/AAAAAAAABUY/QEDQsiD-lW02wRte51a3u-QcWbkI7UXnwCLcBGAs/s1600/2019-02-10%2B07_52_50-Window.png" /></a></div><div class="separator" style="clear: both; text-align: center;"></div><br />ldapwhoami<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://4.bp.blogspot.com/-Kd11vEtCrZE/XF-d8lB4AoI/AAAAAAAABU0/y9jkA-41zh8nBCZ2omW1s4OAgDtIIyZjgCLcBGAs/s1600/2019-02-10%2B10_42_26-Window.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="100" data-original-width="809" src="https://4.bp.blogspot.com/-Kd11vEtCrZE/XF-d8lB4AoI/AAAAAAAABU0/y9jkA-41zh8nBCZ2omW1s4OAgDtIIyZjgCLcBGAs/s1600/2019-02-10%2B10_42_26-Window.png" /></a></div><br />Sesuikan perintah diatas dengan konfigurasi anda.<br /><br />Selanjutnya menambahkan konfigurasi berikut:<br /><br />3. Instal dan konfigurasi OpenVPN auth OpenLDAP<br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">#apt-get install openvpn-auth-ldap</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">#mkdir /etc/openvpn/auth</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">#cp /usr/share/doc/openvpn-auth-ldap/examples/auth-ldap.conf /etc/openvpn/auth&nbsp;</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">Edit /etc/openvpn/auth/auth-ldap.conf:</span><br /><br />auth-ldap.conf file<br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&lt;LDAP&gt;</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"># LDAP server URL</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><b>URL ldap://192.168.1.112</b> ## Your IP LDAP server or Domain (make sure it's resolved)</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"># Bind DN (If your LDAP server doesn't support anonymous binds)</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"># BindDN uid=Manager,ou=People,dc=example,dc=com</span><br /><b><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">BindDN cn=admin,dc=nusantara,dc=cloud</span></b><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"># Bind Password</span><br /><b><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">Password Skill39</span></b><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"># Network timeout (in seconds)</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">Timeout 15</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"># Enable Start TLS</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><b>#TLSEnable yes ##disable this if not use TLS</b></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"># Follow LDAP Referrals (anonymously)</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">FollowReferrals yes</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"># TLS CA Certificate File</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">#TLSCACertFile /usr/local/etc/ssl/ca.pem</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"># TLS CA Certificate Directory</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">#TLSCACertDir /etc/ssl/certs</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"># Client Certificate and key</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"># If TLS client authentication is required</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">#TLSCertFile /usr/local/etc/ssl/client-cert.pem</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">#TLSKeyFile /usr/local/etc/ssl/client-key.pem</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"># Cipher Suite</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"># The defaults are usually fine here</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"># TLSCipherSuite ALL:!ADH:@STRENGTH</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&lt;/LDAP&gt;</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&lt;Authorization&gt;</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"># Base DN</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">#BaseDN "ou=People,dc=example,dc=com"</span><br /><b><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">BaseDN "ou=VPN,dc=nusantara,dc=cloud"</span></b><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"># User Search Filter</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">#SearchFilter "(&amp;(uid=%u)(accountStatus=active))"</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><b>SearchFilter "(&amp;(uid=%u))" </b>## This can be defined according to your LDAP server.</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"># Require Group Membership</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">RequireGroup false</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"># Add non-group members to a PF table (disabled)</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">#PFTable ips_vpn_users</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">#&lt;Group&gt;</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">#BaseDN "ou=Groups,dc=example,dc=com"</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">#SearchFilter "(|(cn=developers)(cn=artists))"</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">#MemberAttribute uniqueMember</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"># Add group members to a PF table (disabled)</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">#PFTable ips_vpn_eng</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">#&lt;/Group&gt;</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&lt;/Authorization&gt;</span><br /><br />Kemudian tambahkan baris konfigurasi paling bawah di server.conf pada OpenVPN server berikut:<br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">plugin /usr/lib/openvpn/openvpn-auth-ldap.so /etc/openvpn/auth/auth-ldap.conf</span><br /><br />Selanjutnya konfigurasi pada OpenVPN client<br /><br />Tambahkan baris konfigurasi berikut di client.conf atau client.ovpn<br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">auth-user-pass</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span><span style="font-family: inherit;">Restart semua service OpenVPN dan uji coba kembali koneksi anda.</span><br /><br />Langkah-langkah troubleshooting:<br /><br />1. Siapkan kesabaran dan ketekunan<br />2. Check step by step konfigurasi<br />3. Check log, OpenVPN Debian default log /var/log/syslog<br />4. Crosscheck antar tutorial<br /><br /><a href="https://nciptandani.blogspot.com/2019/01/tips-troubleshooting-networksystems.htm">https://nciptandani.blogspot.com/2019/01/tips-troubleshooting-networksystems.htm</a>l<br /><br />