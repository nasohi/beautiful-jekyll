---
layout: post
title: PostgreSQL UPSERT
date: '2019-01-31T19:27:00.000+07:00'
author: Nasohi Ciptandani
tags:
- NodeJS
- PostgreSQL
modified_time: '2019-02-01T11:09:32.566+07:00'
blogger_id: tag:blogger.com,1999:blog-7821506235811301823.post-8955402943788473621
blogger_orig_url: https://nciptandani.blogspot.com/2019/01/postgresql-upsert.html
---

Example SQL Syntax:<br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">INSERT INTO student (id, name)</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; VALUES (5, 'Nasohi Ciptandani')</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; ON CONFLICT (id) DO UPDATE SET name = EXCLUDED.name;</span><br /><br />Example Node.js code<br /><br />queries.js file:<br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp;const Pool = require('pg').Pool</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp;const pool = new Pool({</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; user: 'monitoring',</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; host: 'localhost',</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; database: 'monitoring',</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; password: 'p4ssw0rd',</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; port: 5432,</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp;})</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp;&nbsp;</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; pool.query("DELETE FROM linux_server_status", (error, results) =&gt; {</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; &nbsp;console.log(error, results);</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; });</span><br /><br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; const createLinux = (request, response) =&gt; {</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp;const {hostname, ip, os, hdd_total, hdd_used, hdd_free, mem_total, mem_free, mem_used, core } = request.body</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp;const now = new Date();</span><br /><br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp;pool.query('INSERT INTO linux_server_status (hostname, ip, os, hdd_total, hdd_used, hdd_free, mem_total, mem_free, mem_used, core, last_update) VALUES ($1, $2, $3, $4 , $5, $6, $7, $8, $9, $10, $11) ON CONFLICT (HOSTNAME) DO UPDATE SET ip = $2, os = $3, hdd_total = $4, hdd_used = $5, hdd_free = $6, mem_total = $7, mem_free = $8, mem_used = $9, core = $10, last_update = $11 ', [hostname, ip, os, hdd_total, hdd_used, hdd_free, mem_total, mem_free, mem_used, core,&nbsp; now], (error, results) =&gt; {</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; &nbsp;console.log(error, results);</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; &nbsp; response.send("OK");</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; });</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; }</span><br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; module.exports = {</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp;createLinux,</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; }</span><br /><div><br /></div><div>index.js file:</div><div><br /></div><div><div><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp;var express = require("express");</span></div><div><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp;var myParser = require("body-parser");</span></div><div><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp;const db = require('./queries');</span></div><div><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp;&nbsp;</span></div><div><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp;var app = express();</span></div><div><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp;app.use(myParser.urlencoded({extended : true}));</span></div><div><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp;app.use(myParser.json());</span></div><div><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp;app.post("/form", db.createLinux);</span></div><div><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp;&nbsp;</span></div><div><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp;app.listen(3000);</span></div></div><div><br /></div><br /><a href="https://www.postgresql.org/docs/9.5/sql-insert.html">https://www.postgresql.org/docs/9.5/sql-insert.html</a><br /><a href="https://www.alibabacloud.com/help/doc-detail/52951.htm">https://www.alibabacloud.com/help/doc-detail/52951.htm</a><br /><br /><br />