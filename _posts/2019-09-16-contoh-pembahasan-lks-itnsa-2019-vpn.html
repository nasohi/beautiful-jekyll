---
layout: post
title: Contoh pembahasan LKS ITNSA 2019 VPN Configuration
date: '2019-09-16T16:08:00.001+07:00'
author: Nasohi Ciptandani
tags:
- ITNSA
- VPN
- LKS
modified_time: '2019-09-16T16:10:44.386+07:00'
blogger_id: tag:blogger.com,1999:blog-7821506235811301823.post-8022595517164400886
blogger_orig_url: https://nciptandani.blogspot.com/2019/09/contoh-pembahasan-lks-itnsa-2019-vpn.html
---

Pada tutorial kali ini akan mempraktekkan VPN&nbsp;<i>site to site</i>&nbsp;dengan menggunakan ASA, secara fungsi VPN&nbsp;<i>site to site</i>&nbsp;ini akan mengamankan jaringan antar site misalnya site kantor pusat dan kantor cabang yang melalui jaringan internet. Didalam pembuatan VPN site to site ini akan ada beberapa istilah seperti IKEV2, IPSEC,&nbsp;<i>Phase 1 parameters (Hash, Encryption, DH group, Authentication), Phase 2 parameters (Protocol, Encryption, Hash)</i>. Yang perlu diperhatikan pada saat konfigurasi adalah parameter-parameter tersebut harus sesuai/<i>matching</i> antar kedua router ASA.<br /><br />Sebelum melakukan konfigurasi VPN site to site IKE versi 2 dengan ASA pastikan terlebih dahulu koneksi IP nya bisa berjalan dengan baik.<br /><br />Contoh topologi<br /><br /><b>&nbsp;HQLAN---------FW1------------INTERNET--------------FW2----------BRLAN</b><br /><br />Kemudian lakukan langkah-langkah konfigurasi ini:<br /><i>Note:</i> Pembahasan ini hanyalah contoh, untuk <i>attribute,environment</i> konfigurasi seperti&nbsp; <i>Topology,&nbsp;Hostname, IP, Parameters, Subnet, Traffic, ACL, Protocol&nbsp;</i>bisa disesuaikan dengan kebutuhan&nbsp;<i>task project</i>&nbsp;nya.<br /><b><br /></b><b>Configure IKEv2 IPsec Site-to-Site VPN on FW1, FW2 firewalls:</b><br /><br /><b>- Phase 1 parameters:</b><br /><i>Hash – MD5</i><br /><i>Encryption – AES-128</i><br /><i>DH group – 5</i><br /><i>Authentication – pre-shared key (cisco1)</i><br /><br /><b>- Phase 2 parameters:</b><br /><i>Protocol – ESP</i><br /><i>Encryption – AES-128</i><br /><i>Hash – MD5</i><br /><br /><b>- ACL:</b><br /><br /><i>For transmission through IPsec tunnel permit all TCP traffic from network of IP address of HQ2 subinterface in LAN2 subnet to network of IP address of BR2 interface in LAN3 subnet.</i><br /><br /><i>Task</i> diatas lumayan <i>tricky</i> pakai paket TCP jadi tidak bisa cek trafik pakai ICMP, jadi nanti bisa kirim paket TCP dari LAN2 subnet ke LAN3 subnet atau sebaliknya. Untuk cek trafik bisa juga langsung dilakukan di router ASA.<br /><br /><b>Phase 1 configuration</b><br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">crypto ikev2 policy 10</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp;encryption <b>aes-128</b></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp;integrity <b>md5</b></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp;group 5</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">crypto ikev2 enable outside</span><br /><br />Phase 2 configuration<br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">crypto ipsec ikev2 ipsec-proposal <b>VPN-TRANSFORM</b></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp;protocol esp encryption <b>aes-128</b></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp;protocol esp integrity <b>md5</b></span><br /><br /><b>ACL configuration</b><br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">object network <b>HQLAN</b></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">subnet 192.168.30.0 255.255.255.0</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">object network <b>BRLAN</b></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">subnet 172.16.20.0 255.255.255.0</span><br /><br />Untuk access-list sesuikan di FW1 dan FW2<br /><br /><b>FW1</b><br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">access-list <b>HQLAN-TO-BRLAN</b>&nbsp;extended permit tcp object <b>HQLAN&nbsp;</b>object <b>BRLAN</b></span><br /><b><br /></b><b>FW2</b><br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">access-list <b>BRLAN-TO-HQLAN</b>&nbsp;extended permit tcp object <b>BRLAN</b>&nbsp;object <b>HQLAN</b></span><br /><br /><br /><b>CRYPTO MAP</b><br /><br /><b>FW1</b><br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">crypto map SITE-TO-SITE 10 match address&nbsp;<b>HQLAN-TO-BRLAN</b></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">crypto map SITE-TO-SITE 10 set peer <b>100.100.100.2&nbsp;</b></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">crypto map SITE-TO-SITE 10 set ikev2 ipsec-proposal <b>VPN-TRANSFORM</b></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">crypto map SITE-TO-SITE interface outside</span><br /><br />Sesuaikan juga&nbsp;<i>match address </i>lawan dan <i>seet peer</i> di FW2.<br /><br /><b>TUNNEL</b><br /><b><br /></b><b>FW1</b><br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">tunnel-group <b>100.100.100.2</b> type ipsec-l2l</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">tunnel-group <b>100.100.100.2</b> ipsec-attributes</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp;ikev2 remote-authentication pre-shared-key <b>cisco1</b></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp;ikev2 local-authentication pre-shared-key <b>cisco1</b></span><br /><br />Sesuikan IP tunnel group dengan IP lawan FW2.<br />Misalnya diatas adalah konfigurasi di FW1, IP FW2 adalah 100.100.100.2.<br /><br /><b><br /></b><b>VERIFIKASI</b><br /><b><br /></b><b>Cek konfigurasi</b><br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">sh run crypto</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">sh run tunnel-group</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">sh run access-list</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">sh run object</span><br /><br /><b>Cek traffik</b><br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">ping tcp</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">show cryptop ipsec sa</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span><span style="font-family: inherit;">Perhatikan pada packet, jika berhasil maka nilainya akan terus bertambah sesuai dengan traffik yang ada.</span><br /><span style="font-family: inherit;"><br /></span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp;#pkts encaps: 7767918, #pkts encrypt: 7767918, #pkts digest 7767918</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; #pkts decaps: 7760382, #pkts decrypt: 7760382, #pkts verify 7760382</span><br /><br /><b>DEBUG</b><br /><b><br /></b><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">debug crypto ikev2</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">debug crypto ipsec</span><br /><br /><br /><br /><br /><br /><br /><br />