---
layout: post
title: How to make an CA, Intermediate CA / Sub CA, and Server Certificate with OpenSSL
  command
date: '2019-09-08T12:37:00.002+07:00'
author: Nasohi Ciptandani
tags:
- CA
modified_time: '2019-09-10T17:02:09.804+07:00'
thumbnail: https://1.bp.blogspot.com/-DF6JfusTQ7o/XXSO5V763uI/AAAAAAAABus/etqm7Om-UHgDpFZO_qAY9H4EPipJO4tpgCLcBGAs/s72-c/2019-09-08%2B12_11_41-Window.png
blogger_id: tag:blogger.com,1999:blog-7821506235811301823.post-7600268205250910553
blogger_orig_url: https://nciptandani.blogspot.com/2019/09/how-to-make-ca-intermediate-ca-sub-ca.html
---

- Keep RootCA.key and IntermediateCA.key securely.<br />- Upload RootCA.crt and IntermediateCA.crt to client's system or browser.<br />- Use IntermediateCA to sign server certificate needs (webserver, FTP server, mail server, etc)<br /><br />This configuration just example, configure the certificate name, attribute according to your needs.<br /><br />In this tutorial we use OpenSSL command but you can also use CA.pl script from OpenSSL.<br /><b><br /></b><b>1. Generate Root Certificate key.</b><br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">openssl genrsa -out RootCA.key 4096</span><br /><br /><b>2. Generate Root certificate.</b><br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">openssl req -new -x509 -days 1826 -key RootCA.key -out RootCA.crt</span><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-DF6JfusTQ7o/XXSO5V763uI/AAAAAAAABus/etqm7Om-UHgDpFZO_qAY9H4EPipJO4tpgCLcBGAs/s1600/2019-09-08%2B12_11_41-Window.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="320" data-original-width="691" src="https://1.bp.blogspot.com/-DF6JfusTQ7o/XXSO5V763uI/AAAAAAAABus/etqm7Om-UHgDpFZO_qAY9H4EPipJO4tpgCLcBGAs/s1600/2019-09-08%2B12_11_41-Window.png" /></a></div><br /><br /><b>Generate Intermediate CA</b><br /><b><br /></b>Create a file subca.conf with the following contents:<br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-ZfIuE1iMPoI/XXS46mAnWOI/AAAAAAAABv4/xaJ0g4P3lmUEgNGBGX0ADtmHAYiBttbkQCLcBGAs/s1600/2019-09-08%2B15_16_18-Window.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="115" data-original-width="292" height="157" src="https://1.bp.blogspot.com/-ZfIuE1iMPoI/XXS46mAnWOI/AAAAAAAABv4/xaJ0g4P3lmUEgNGBGX0ADtmHAYiBttbkQCLcBGAs/s400/2019-09-08%2B15_16_18-Window.png" width="400" /></a></div><br /><b>1. Generate Intermediate CA certificate key</b><br /><b><br /></b><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">openssl genrsa -out IntermediateCA.key 4096</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span><br /><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-z07B5osqJ6A/XXSQ3qux8LI/AAAAAAAABvc/ZOagowE4yEM02fJGxhaYeqjkkk888SmLwCLcBGAs/s1600/2019-09-08%2B12_25_13-Window.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="81" data-original-width="537" src="https://1.bp.blogspot.com/-z07B5osqJ6A/XXSQ3qux8LI/AAAAAAAABvc/ZOagowE4yEM02fJGxhaYeqjkkk888SmLwCLcBGAs/s1600/2019-09-08%2B12_25_13-Window.png" /></a></div><br /><br /><b>2. Generate Intermediate CA CSR</b>.<br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">openssl req -new -key IntermediateCA.key -out IntermediateCA.csr</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-QYdwp7bs2H8/XXSQ3ToSeAI/AAAAAAAABvY/OxWSL4IAji4djTGVANCgihT6lG4SqlkigCLcBGAs/s1600/2019-09-08%2B12_12_30-Window.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="306" data-original-width="690" src="https://1.bp.blogspot.com/-QYdwp7bs2H8/XXSQ3ToSeAI/AAAAAAAABvY/OxWSL4IAji4djTGVANCgihT6lG4SqlkigCLcBGAs/s1600/2019-09-08%2B12_12_30-Window.png" /></a></div><br /><b>3. Sign the Intermediate CA by the Root CA.</b><br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">openssl x509 -extfile subca.conf -extensions v3_subca -req -days 1000 -in IntermediateCA.csr -CA RootCA.crt -CAkey RootCA.key -CAcreateserial -out IntermediateCA.crt</span><br /><br /><div class="separator" style="clear: both; text-align: center;"></div><a href="https://1.bp.blogspot.com/-AS65oa4tPUs/XXS4Y03M-XI/AAAAAAAABvw/VH1WmBh1mpk1mlE6-lsvmRobAuPO6TR1ACLcBGAs/s1600/2019-09-08%2B15_13_08-Window.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em; text-align: center;"><img border="0" data-original-height="188" data-original-width="1365" height="88" src="https://1.bp.blogspot.com/-AS65oa4tPUs/XXS4Y03M-XI/AAAAAAAABvw/VH1WmBh1mpk1mlE6-lsvmRobAuPO6TR1ACLcBGAs/s640/2019-09-08%2B15_13_08-Window.png" width="640" /></a><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span>And then generate server certificate (webserver, ftp server, mail server, etc)<br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span><br /><div class="separator" style="clear: both; text-align: center;"></div><div class="separator" style="clear: both; text-align: center;"></div><b>1. Generate Server certificate key</b><br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">openssl genrsa -out Server.key 2048</span><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-J-cyMtBcp5Y/XXSO5PLfOkI/AAAAAAAABvA/jKxQFs7biqsvTn4LqKjN54I9mPWp4tNTACEwYBhgL/s1600/2019-09-08%2B12_08_56-Window.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="78" data-original-width="621" src="https://1.bp.blogspot.com/-J-cyMtBcp5Y/XXSO5PLfOkI/AAAAAAAABvA/jKxQFs7biqsvTn4LqKjN54I9mPWp4tNTACEwYBhgL/s1600/2019-09-08%2B12_08_56-Window.png" /></a></div><br /><b>2- Create Server Cert CSR</b><br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">openssl req -new -key Server.key -out Server.csr</span><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-eBmGouRVHlY/XXSO47ErT-I/AAAAAAAABu8/4zTE8YrTQB0Ccfargc1ofLXkfUHQ8IRPgCEwYBhgL/s1600/2019-09-08%2B12_07_51-Window.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="306" data-original-width="597" src="https://1.bp.blogspot.com/-eBmGouRVHlY/XXSO47ErT-I/AAAAAAAABu8/4zTE8YrTQB0Ccfargc1ofLXkfUHQ8IRPgCEwYBhgL/s1600/2019-09-08%2B12_07_51-Window.png" /></a></div><br /><br /><b>3- Sign the Server cert CSR using IntermediateCA</b><br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">openssl x509 -req -days 1000 -in Server.csr -CA IntermediateCA.crt -CAkey IntermediateCA.key -set_serial 0101&nbsp; -out Server.crt -sha1</span><br /><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-W_2JyVOcjH4/XXSO4ZcjyzI/AAAAAAAABvE/RfIeexgr3FgjxjCEJTWBKEPbkGhpwizxwCEwYBhgL/s1600/2019-09-08%2B12_06_19-Window.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="64" data-original-width="1222" src="https://1.bp.blogspot.com/-W_2JyVOcjH4/XXSO4ZcjyzI/AAAAAAAABvE/RfIeexgr3FgjxjCEJTWBKEPbkGhpwizxwCEwYBhgL/s1600/2019-09-08%2B12_06_19-Window.png" /></a></div><br /><b>Verify</b><br /><b><br /></b><br /><div class="separator" style="clear: both; text-align: center;"><a href="https://1.bp.blogspot.com/-pHc2b1Aa4Tg/XXTMNmTLLXI/AAAAAAAABwE/UdTEwpXLXb4q3AWC1Kd_dbGn-l3hQ2JxACLcBGAs/s1600/2019-09-08%2B16_38_24-Window.png" imageanchor="1" style="margin-left: 1em; margin-right: 1em;"><img border="0" data-original-height="41" data-original-width="766" height="33" src="https://1.bp.blogspot.com/-pHc2b1Aa4Tg/XXTMNmTLLXI/AAAAAAAABwE/UdTEwpXLXb4q3AWC1Kd_dbGn-l3hQ2JxACLcBGAs/s640/2019-09-08%2B16_38_24-Window.png" width="640" /></a></div><br /><b>Send RootCA.crt and IntermediateCA.crt to client</b><br /><br />Bundle RootCA.crt and IntermediateCA.crt into one file CA.crt with the following command:<br /><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">cat IntermediateCA.crt &gt; CA.crt</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">cat RootCA.crt &gt;&gt; CA.crt</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span><span style="font-family: inherit;"><b>Example SSL configuration on Apache2</b></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><br /></span><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp;&lt;VirtualHost 192.168.1.1:443&gt;</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; DocumentRoot /var/www/html</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; ServerName www.yourdomain.com</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; &nbsp; &nbsp; SSLEngine on</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; &nbsp; &nbsp; SSLCertificateFile /path/to/your_server.crt</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; &nbsp; &nbsp; SSLCertificateKeyFile /path/to/your_server.key</span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"><b>&nbsp; &nbsp; &nbsp; &nbsp; SSLCertificateChainFile /path/to/IntermediateCA.crt</b></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;"></span><br /><span style="font-family: &quot;courier new&quot; , &quot;courier&quot; , monospace;">&nbsp; &nbsp; &lt;/VirtualHost&gt;</span><br /><br /><br />